(function(t){function e(e){for(var s,i,r=e[0],l=e[1],o=e[2],u=0,_=[];u<r.length;u++)i=r[u],a[i]&&_.push(a[i][0]),a[i]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);d&&d(e);while(_.length)_.shift()();return c.push.apply(c,o||[]),n()}function n(){for(var t,e=0;e<c.length;e++){for(var n=c[e],s=!0,i=1;i<n.length;i++){var r=n[i];0!==a[r]&&(s=!1)}s&&(c.splice(e--,1),t=l(l.s=n[0]))}return t}var s={},i={app:0},a={app:0},c=[];function r(t){return l.p+"js/"+({}[t]||t)+"."+{"chunk-1a8da500":"bb701966","chunk-2d0cb76d":"23617887","chunk-2d22fd71":"f122a58c"}[t]+".js"}function l(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.e=function(t){var e=[],n={"chunk-1a8da500":1};i[t]?e.push(i[t]):0!==i[t]&&n[t]&&e.push(i[t]=new Promise(function(e,n){for(var s="css/"+({}[t]||t)+"."+{"chunk-1a8da500":"fe496cd7","chunk-2d0cb76d":"31d6cfe0","chunk-2d22fd71":"31d6cfe0"}[t]+".css",a=l.p+s,c=document.getElementsByTagName("link"),r=0;r<c.length;r++){var o=c[r],u=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(u===s||u===a))return e()}var _=document.getElementsByTagName("style");for(r=0;r<_.length;r++){o=_[r],u=o.getAttribute("data-href");if(u===s||u===a)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var s=e&&e.target&&e.target.src||a,c=new Error("Loading CSS chunk "+t+" failed.\n("+s+")");c.request=s,delete i[t],d.parentNode.removeChild(d),n(c)},d.href=a;var f=document.getElementsByTagName("head")[0];f.appendChild(d)}).then(function(){i[t]=0}));var s=a[t];if(0!==s)if(s)e.push(s[2]);else{var c=new Promise(function(e,n){s=a[t]=[e,n]});e.push(s[2]=c);var o,u=document.createElement("script");u.charset="utf-8",u.timeout=120,l.nc&&u.setAttribute("nonce",l.nc),u.src=r(t),o=function(e){u.onerror=u.onload=null,clearTimeout(_);var n=a[t];if(0!==n){if(n){var s=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src,c=new Error("Loading chunk "+t+" failed.\n("+s+": "+i+")");c.type=s,c.request=i,n[1](c)}a[t]=void 0}};var _=setTimeout(function(){o({type:"timeout",target:u})},12e4);u.onerror=u.onload=o,document.head.appendChild(u)}return Promise.all(e)},l.m=t,l.c=s,l.d=function(t,e,n){l.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},l.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)l.d(n,s,function(e){return t[e]}.bind(null,s));return n},l.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return l.d(e,"a",e),e},l.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},l.p="/",l.oe=function(t){throw console.error(t),t};var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var _=0;_<o.length;_++)e(o[_]);var d=u;c.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},4785:function(t,e,n){},"49ac":function(t,e,n){},"4d93":function(t,e,n){},"521c":function(t,e,n){"use strict";var s=n("4785"),i=n.n(s);i.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var s=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.cities?n("div",[n("Filters"),n("Table")],1):n("p",[t._v("Загрузка...")])])},a=[],c=(n("f5df"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"filters"},[n("div",{staticClass:"container"},[n("div",{staticClass:"filters__list"},[n("div",{staticClass:"filters__item filters__item--date"},[n("Date")],1),n("div",{staticClass:"filters__item filters__item--select"},[n("Select")],1),n("div",{staticClass:"filters__item filters__item--select"},[n("User")],1)])])])}),r=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"filter-item"},[n("p",{staticClass:"filter-item__label"},[t._v("Дата")]),n("date-picker",{staticClass:"filter-item__input",attrs:{range:"",shortcuts:!1,lang:t.lang,format:"DD-MM-YYYY","custom-formatter":t.formatDate},on:{change:t.confirmHandler},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)},o=[],u={name:"Date",components:{DatePicker:function(){return n.e("chunk-2d22fd71").then(n.t.bind(null,"ea76",7))}},data:function(){return{date:this.$store.getters.getFilterDates,lang:"ru",shortcuts:!1}},methods:{formatDate:function(t){return console.log(t),t},confirmHandler:function(t){this.$store.commit({type:"filterDate",date:t})}}},_=u,d=(n("521c"),n("2877")),f=Object(d["a"])(_,l,o,!1,null,null,null),p=f.exports,m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"filter-item"},[n("p",{staticClass:"filter-item__label"},[t._v("Филиал")]),n("v-select",{staticClass:"filter-item__input",attrs:{placeholder:"В городе",options:t.cityNames},on:{input:t.changeHandler}})],1)},v=[],h=(n("7f7f"),{name:"Select",components:{"v-select":function(){return n.e("chunk-2d0cb76d").then(n.t.bind(null,"4a7a",7))}},computed:{cities:function(){return this.$store.state.cities},cityNames:function(){return this.cities.map(function(t){return{value:t.id,label:t.name}})}},methods:{changeHandler:function(t){this.$store.commit({type:"filterCity",city:t})}}}),g=h,y=(n("d40f"),Object(d["a"])(g,m,v,!1,null,null,null)),C=y.exports,b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"filter-item"},[n("p",{staticClass:"filter-item__label"},[t._v("Сотрудник")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.val,expression:"val"}],staticClass:"filter-item__input",attrs:{type:"text",placeholder:"ФИО"},domProps:{value:t.val},on:{input:function(e){e.target.composing||(t.val=e.target.value)}}})])},w=[],k={name:"User",computed:{val:{get:function(){return this.$store.state.filters.employee},set:function(t){this.$store.commit({type:"filterName",name:t})}}}},O=k,j=Object(d["a"])(O,b,w,!1,null,"dd9a0936",null),x=j.exports,M={name:"Filters",components:{Date:p,Select:C,User:x}},E=M,$=(n("e4c4"),Object(d["a"])(E,c,r,!1,null,null,null)),S=$.exports,T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"result"},[n("div",{staticClass:"container"},[t._m(0),n("div",{staticClass:"result__body"},t._l(t.cities,function(t){return n("City",{key:t.id,attrs:{city:t}})}),1)]),n("modals-container")],1)},D=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"result__header"},[n("div",{staticClass:"result__row result__row--names"},[n("div",{staticClass:"result__td result__td--bdr result__td--info"},[t._v("Общая информация")]),n("div",{staticClass:"result__td result__td--bdr result__td--missed"},[t._v("Пропущенные")]),n("div",{staticClass:"result__td result__td--successful"},[t._v("Успешные")])]),n("div",{staticClass:"result__row"},[n("div",{staticClass:"result__td result__td--left"},[t._v("Филиал")]),n("div",{staticClass:"result__td result__td--left"},[t._v("Cотрудник ОП")]),n("div",{staticClass:"result__td"}),n("div",{staticClass:"result__td result__td--bdr"},[t._v("Кол-во входящих")]),n("div",{staticClass:"result__td"},[t._v("Входящие")]),n("div",{staticClass:"result__td"},[t._v("Неотработанные")]),n("div",{staticClass:"result__td"},[t._v("Отработанные")]),n("div",{staticClass:"result__td result__td--bdr"},[t._v("Отработанные не вовремя")]),n("div",{staticClass:"result__td"},[t._v("Входящие")]),n("div",{staticClass:"result__td"},[t._v("Исходящие")])])])}],N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.users.length>0?n("div",{staticClass:"city",class:{"city--open":t.isOpen}},[n("div",{staticClass:"result__row"},[n("div",{staticClass:"result__td result__td--city",class:t.modClass,on:{click:function(e){return t.changeOpen()}}},[t._v(t._s(t.city.name))]),n("div",{staticClass:"result__td result__td--empty"}),n("div",{staticClass:"result__td"},[t._v(t._s(t.city.total.percents)+"%")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"summ"})}}},[t._v("\n      "+t._s(t.city.total.incoming)+"\n    ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"fail"})}}},[t._v("\n      "+t._s(t.city.incoming.fail)+"\n    ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"not_waste"})}}},[t._v("\n      "+t._s(t.city.incoming.not_waste)+"\n    ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"waste_success"})}}},[t._v("\n      "+t._s(t.city.incoming.waste_success)+"\n    ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"waste_fail"})}}},[t._v("\n      "+t._s(t.city.incoming.waste_fail)+"\n    ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"success"})}}},[t._v("\n      "+t._s(t.city.incoming.success)+"\n    ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"outgoing",call_status:"success"})}}},[t._v(t._s(t.city.outgoing.success))])]),t._l(t.users,function(e){return t.isOpen?n("Employee",{key:e.id,attrs:{employee:e}}):t._e()})],2):t._e()},P=[],q=n("cebc"),F=(n("55dd"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal"},[t.calls?n("div",[n("p",{staticClass:"modal__name"},[t._v("Все "+t._s(t.propToString("call_type"))+" "+t._s(t.propToString("call_status"))+" "+t._s(t.getRange))]),n("div",{staticClass:"modal__row"},[n("div",{staticClass:"modal__about"},[n("div",{staticClass:"modal__header"},[n("p",[t._v(t._s(t.propToString("type")))])]),n("p",{staticClass:"modal__who"},[t._v(t._s(t.name))])]),n("div",{staticClass:"modal__info"},[t._m(0),n("div",{staticClass:"call"},[n("div",{staticClass:"call__list"},t._l(t.calls,function(e){return n("div",{staticClass:"call__item"},[n("div",{staticClass:"call__info"},[n("p",{staticClass:"call__date"},[t._v(t._s(e.date)),n("br"),t._v("в "+t._s(e.time))]),n("p",{staticClass:"call__phone"},[t._v(t._s(e.phone))]),n("div",{staticClass:"call__author"},[n("a",{staticClass:"call__author-link",attrs:{href:e.crm.link.src,target:"_blank"}},[t._v(t._s(e.crm.link.title))]),n("p",{staticClass:"call__author-type"},[t._v(t._s(e.crm.link.name))])])]),n("audio",{staticClass:"call__audio",attrs:{src:e.crm.audio,controls:""}})])}),0)])])]),n("Pagination",{attrs:{pages:t.pages},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1):n("p",{staticClass:"modal__loading"},[t._v("Загрузка...")])])}),U=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal__header"},[n("p",[t._v("Дата")]),n("p",[t._v("Номер телефона")]),n("p",[t._v("CRM")])])}],A=(n("c5f6"),function(t){if(t.ok)return t;throw new Error("".concat(t.status,": ").concat(t.statusText))});function H(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n="";for(var s in t){var i=t[s];i&&(n="".concat(n,"&").concat(s,"=").concat(i))}return n=""===n?"":"?".concat(n.slice(1)),"".concat(e).concat(n)}function L(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=H(e,t);return fetch(n).then(A).then(function(t){return t.json()})}var Y={cities:"data.json",modal:"modal.json"},B={type:{department:"Филиал",user:"Сотрудник"},call_type:{incoming:"входящие",outgoing:"исходящие"},call_status:{summ:"",fail:"пропущенные",not_waste:"неотработанные",waste_success:"отработанные",waste_fail:"отработанные не вовремя",success:"успешные"}},R={year:"numeric",month:"numeric",day:"numeric",timezone:"UTC"};function J(t){return t?t.toLocaleString("ru",R):null}var z={year:"numeric",month:"numeric",day:"numeric"},G={name:"Modal",components:{Pagination:function(){return n.e("chunk-1a8da500").then(n.bind(null,"1799"))}},props:{call_type:{type:String,required:!0},call_status:{type:String,required:!0},id:{type:Number,required:!0},type:{type:String,required:!0},name:{type:String,required:!0}},data:function(){return{date:this.$store.getters.getFilterDates,calls:null,page:1,pages:0}},computed:{getRange:function(){if(!this.date[0])return"";var t=this.date.map(function(t){return new Date(t).toLocaleString("ru",z)});return"с ".concat(t[0]," по ").concat(t[1])}},watch:{page:function(){this.calls=null,this.loadContent()}},methods:{loadContent:function(){var t=this;L(Y.modal,{id:this.id,type:this.type,call_type:this.call_type,call_status:this.call_status,page:this.page,min_date:J(this.date[0]),max_date:J(this.date[1])}).then(function(e){t.calls=Object(q["a"])({},e.response.data),t.pages=+e.response.pages})},propToString:function(t){return B[t][this[t]]}},mounted:function(){this.loadContent()}},I=G,K=(n("7b06"),Object(d["a"])(I,F,U,!1,null,null,null)),Q=K.exports,V=function(t){var e=t.context,n=t.params;e.$modal.show(Q,Object(q["a"])({},n),{width:"913px",height:"auto"})},W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"result__row",class:t.modClass},[n("div",{staticClass:"result__td result__td--empty"}),n("div",{staticClass:"result__td result__td--name"},[t._v(t._s(t.employee.name))]),n("div",{staticClass:"result__td"},[t._v(t._s(t.employee.total.percents)+"%")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"summ"})}}},[t._v("\n    "+t._s(t.employee.total.incoming)+"\n  ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"fail"})}}},[t._v("\n    "+t._s(t.employee.incoming.fail)+"\n  ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"not_waste"})}}},[t._v("\n    "+t._s(t.employee.incoming.not_waste)+"\n  ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"waste_success"})}}},[t._v("\n    "+t._s(t.employee.incoming.waste_success)+"\n  ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"waste_fail"})}}},[t._v("\n    "+t._s(t.employee.incoming.waste_fail)+"\n  ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"incoming",call_status:"success"})}}},[t._v("\n    "+t._s(t.employee.incoming.success)+"\n  ")]),n("div",{staticClass:"result__td",on:{click:function(e){return t.openModal({call_type:"outgoing",call_status:"success"})}}},[t._v("\n    "+t._s(t.employee.outgoing.success)+"\n  ")])])},X=[],Z={name:"Employee",props:{employee:{type:Object,required:!0}},computed:{modClass:function(){var t=this.employee.total.percents;return t<=5?"result__row--success":t>5&&t<10?"result__row--warning":"result__row--fail"}},methods:{openModal:function(t){V({context:this,params:Object(q["a"])({},t,{id:this.employee.id,name:this.employee.name,type:"user"})})}}},tt=Z,et=Object(d["a"])(tt,W,X,!1,null,null,null),nt=et.exports,st={name:"City",components:{Employee:nt},props:{city:{type:Object,required:!0}},data:function(){return{isOpen:!1}},computed:{filterName:function(){return this.$store.state.filters.employee},users:function(){var t=this;return this.city.users.filter(function(e){return!t.filterName||-1!==e.name.toUpperCase().indexOf(t.filterName.toUpperCase())}).sort(function(t,e){return+e.total.percents-+t.total.percents})},modClass:function(){var t=this.city.total.percents;return t<=5?"result__td--success":t>5&&t<10?"result__td--warning":"result__td--fail"}},methods:{changeOpen:function(){this.isOpen=!this.isOpen},openModal:function(t){V({context:this,params:Object(q["a"])({},t,{id:this.city.id,name:this.city.name,type:"department"})})}}},it=st,at=(n("86e4"),Object(d["a"])(it,N,P,!1,null,null,null)),ct=at.exports,rt={name:"Table",components:{City:ct},computed:{cities:function(){return this.$store.getters.getCities}}},lt=rt,ot=(n("798a"),Object(d["a"])(lt,T,D,!1,null,null,null)),ut=ot.exports,_t={name:"app",components:{Filters:S,Table:ut},computed:{cities:function(){return this.$store.state.cities}},mounted:function(){this.$store.dispatch("loadCities")}},dt=_t,ft=(n("7c55"),Object(d["a"])(dt,i,a,!1,null,null,null)),pt=ft.exports,mt=n("75fc"),vt=n("2f62");function ht(t,e){return 0===e?0:Math.round(t/e*100)}function gt(t){var e=t.incoming.success+t.incoming.fail;t.total={incoming:e,percents:ht(t.incoming.not_waste,e)}}function yt(t,e){for(var n in t.incoming)t.incoming[n]+=+e.incoming[n];for(var s in t.outgoing)t.outgoing[s]+=+e.outgoing[s]}var Ct=function(t){return t.forEach(function(t){t.incoming={fail:0,not_waste:0,success:0,waste_fail:0,waste_success:0},t.outgoing={fail:0,success:0},t.users.forEach(function(e){gt(e),yt(t,e)}),gt(t)}),t};s["a"].use(vt["a"]);var bt=new vt["a"].Store({state:{cities:null,filters:{date:[null,null],city:null,employee:null}},getters:{getCities:function(t){var e=t.filters.city;return t.cities?t.cities.filter(function(t){return!e||t.id===e.value}):null},getFilterDates:function(t){var e=t.filters.date;return e.map(function(t){return t?new Date(t):""})}},mutations:{saveCities:function(t,e){var n=e.cities;t.cities=Object(mt["a"])(n)},filterCity:function(t,e){var n=e.city;t.filters.city=n},filterName:function(t,e){var n=e.name;t.filters.employee=n},filterDate:function(t,e){var n=e.date;t.filters.date=n.map(function(t){return t})}},actions:{loadCities:function(t){var e=this,n=t.state,s=t.commit;L(Y.cities,{min_date:J(n.filters.date[0]),max_date:J(n.filters.date[1])}).then(function(t){return t.response.departments.sort(function(t,e){return t.name>e.name?1:-1})}).then(function(t){return Ct(t)}).then(function(t){s({type:"saveCities",cities:t})}).then(function(){return setTimeout(function(){e.dispatch("loadCities")},1e3)}).catch(function(t){return alert(t.message)})}}}),wt=n("1881"),kt=n.n(wt);s["a"].config.productionTip=!1,s["a"].use(kt.a,{dynamic:!0}),new s["a"]({store:bt,render:function(t){return t(pt)}}).$mount("#app")},"5c48":function(t,e,n){},"64ac":function(t,e,n){},"798a":function(t,e,n){"use strict";var s=n("c627"),i=n.n(s);i.a},"7b06":function(t,e,n){"use strict";var s=n("49ac"),i=n.n(s);i.a},"7c55":function(t,e,n){"use strict";var s=n("5c48"),i=n.n(s);i.a},"86e4":function(t,e,n){"use strict";var s=n("64ac"),i=n.n(s);i.a},c187:function(t,e,n){},c627:function(t,e,n){},d40f:function(t,e,n){"use strict";var s=n("4d93"),i=n.n(s);i.a},e4c4:function(t,e,n){"use strict";var s=n("c187"),i=n.n(s);i.a}});